

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; PISA 4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=0cd558ae"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            PISA
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PISA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/readmes/discr_sys.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p># Stage: Discrete Systematics</p>
<p>These stages apply parameterized systematics to the templates.</p>
<p>## Services</p>
<p>### hypersurfaces</p>
<p>This service applies the results obtained from fits to bin-count expectations given “discrete” MC event simulation samples,
i.e. one per choice of detector-response settings (such as a particular overall DOM efficiency correction).</p>
<p>Fits may be performed for different assumptions of non-detector model parameters, such as oscillation parameters, and then interpolated by this service.
The fitting parameters are computed and stored in a fit results file by the script <cite>$PISA/pisa/scripts/fit_hypersurfaces.py</cite> (command-line alias <cite>pisa-fit_hypersurfaces</cite>).
This has to be executed together with a dedicated fit configuration file (see script’s documentation).</p>
<p>The method itself is described and illustrated in the paper [“Measurement of Atmospheric Neutrino Mixing with Improved IceCube DeepCore
Calibration and Data Processing”](<a class="reference external" href="https://inspirehep.net/literature/2653713">https://inspirehep.net/literature/2653713</a>) (Sec. VI A).</p>
<p>The “hyperplanes” predecessor method presented in the [“Measurement of atmospheric tau neutrino appearance
with IceCube DeepCore”](<a class="reference external" href="https://inspirehep.net/literature/1714067">https://inspirehep.net/literature/1714067</a>) (Sec. V E) is also incorporated.</p>
<p>### csv_hypersurfaces</p>
<p>Service to load and apply (pre-generated) hypersurfaces stored in csv files. This file format is usually used for data releases. Currently, the service expects hypersurfaces in the form of <cite>pisa_examples/resources/events/hs_test.csv</cite>.</p>
<p>### ultrasurfaces</p>
<p>Treatment of detector systematics via likelihood-free inference as described in <a class="reference external" href="https://inspirehep.net/literature/2656204">https://inspirehep.net/literature/2656204</a>.
Polynomial coefficients, assigned to every event, allow continuous re-weighting as a function of detector uncertainties in a way that is fully decoupled
from flux and oscillation effects. The results are stored in a feather file containing all events of the nominal MC set and their associated polynomial coefficients.</p>
<p>To use this in a PISA analysis pipeline, you will need to set up an ultrasurface config file looking like this:</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>ini
[discr_sys.ultrasurfaces]</p>
<p>calc_mode = events
apply_mode = events</p>
<p># DOM efficiency
param.dom_eff = 1.0 +/- 0.1
param.dom_eff.fixed = False
param.dom_eff.range = [0.8, 1.2] * units.dimensionless
param.dom_eff.tex = epsilon_{rm{DOM}}</p>
<p># hole ice scattering
param.hole_ice_p0 = +0.101569
param.hole_ice_p0.fixed = False
param.hole_ice_p0.range = [-0.6, 0.5] * units.dimensionless
param.hole_ice_p0.prior = uniform
param.hole_ice_p0.tex = rm{hole , ice}, : p_0</p>
<p># hole ice forward
param.hole_ice_p1 = -0.049344
param.hole_ice_p1.fixed = False
param.hole_ice_p1.range = [-0.2, 0.2] * units.dimensionless
param.hole_ice_p1.prior = uniform
param.hole_ice_p1.tex = rm{hole , ice}, : p_1</p>
<p># bulk ice absorption
param.bulk_ice_abs = 1.0
param.bulk_ice_abs.fixed = False
param.bulk_ice_abs.range = [0.85, 1.15] * units.dimensionless
param.bulk_ice_abs.prior = uniform
param.bulk_ice_abs.tex = rm{ice , absorption}</p>
<p># bulk ice scattering
param.bulk_ice_scatter = 1.05
param.bulk_ice_scatter.fixed = False
param.bulk_ice_scatter.range = [0.90, 1.20] * units.dimensionless
param.bulk_ice_scatter.prior = uniform
param.bulk_ice_scatter.tex = rm{ice , scattering}</p>
<p># These nominal points are the nominal points that were used to fit the gradients
# and might not agree with the nominal points of the parameter prior.
nominal_points = {“dom_eff”: 1.0, “hole_ice_p0”: 0.101569, “hole_ice_p1”: -0.049344, “bulk_ice_abs”: 1.0, “bulk_ice_scatter”: 1.0}</p>
<p>fit_results_file = /path/to/ultrasurface_fits/genie_all_knn_200pc_weight_weighted_aeff_poly_2.feather
<a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
<p>Here you specify the detector systematic parameters to be varied in the fit, with their nominal values and allowed ranges.
Additionally, you have to specify the nominal point at which the ultrasurfaces were fit (<cite>nominal_points</cite>), since this might be different from the nominal point used in your analysis.
Finally, you have to point to the file where the polynomial coefficients are stored (<cite>fit_results_file</cite>).</p>
<p>Your pipeline’s order could then look like this:</p>
<p><code class="docutils literal notranslate"><span class="pre">`ini</span>
<span class="pre">order</span> <span class="pre">=</span> <span class="pre">data.simple_data_loader,</span> <span class="pre">flux.honda_ip,</span> <span class="pre">flux.mceq_barr,</span> <span class="pre">osc.prob3,</span> <span class="pre">xsec.genie_sys,</span> <span class="pre">xsec.dis_sys,</span> <span class="pre">aeff.aeff,</span> <span class="pre">discr_sys.ultrasurfaces,</span> <span class="pre">utils.hist</span>
<span class="pre">`</span></code></p>
<p>It’s important to include the ultrasurface stage <strong>before</strong> the histogramming stage, unlike it’s done for the hypersurfaces. Now you should be good to go.</p>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, The IceCube/PINGU Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>